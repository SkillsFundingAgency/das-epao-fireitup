var e,t;e=this,t=function(e){function t(e){this.$module=e,this.$sections=e.querySelectorAll(".govuk-accordion__section"),this.$openAllButton=""}function o(e,t){if(window.NodeList.prototype.forEach)return e.forEach(t);for(var o=0;o<e.length;o++)t.call(window,e[o],o,e)}t.prototype.init=function(){var e=this.$module;if(e){this.moduleId=e.getAttribute("id"),o(this.$sections,function(e,t){var o=e.querySelector(".govuk-accordion__section-header");this.setHeaderAttributes(o,t),this.setExpanded(this.isExpanded(e),e),o.addEventListener("click",this.onToggleExpanded.bind(this,e))}.bind(this)),this.$openAllButton=document.createElement("button"),this.setOpenAllButtonAttributes(this.$openAllButton);var t=document.createElement("div");t.setAttribute("class","govuk-accordion__controls"),t.appendChild(this.$openAllButton),this.$module.insertBefore(t,this.$module.firstChild),this.$module.classList.add("with-js"),this.$openAllButton.addEventListener("click",this.openOrCloseAllSections.bind(this)),this.readState();var i=this.checkIfAllSectionsOpen();this.updateOpenAllButton(i)}},t.prototype.onToggleExpanded=function(e){var t=this.isExpanded(e);this.setExpanded(!t,e),this.storeState();var o=this.checkIfAllSectionsOpen();this.updateOpenAllButton(o)},t.prototype.setExpanded=function(e,t){t.querySelector(".govuk-accordion__section-header-button").setAttribute("aria-expanded",e),e?t.classList.add("govuk-accordion__section--expanded"):t.classList.remove("govuk-accordion__section--expanded"),this.$module.className=this.$module.className},t.prototype.isExpanded=function(e){return e.classList.contains("govuk-accordion__section--expanded")},t.prototype.setHeaderAttributes=function(e,t){var o=e.querySelector(".govuk-accordion__section-header-button"),i=document.createElement("button");i.setAttribute("class",o.getAttribute("class")),i.setAttribute("aria-controls",this.moduleId+"-panel-"+(t+1));for(var n=0;n<o.childNodes.length;n++){var s=o.childNodes[n];o.removeChild(s),i.appendChild(s)}e.removeChild(o),e.appendChild(i);var a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("width","16"),a.setAttribute("height","16"),a.setAttribute("viewBox","0 0 32 32"),a.setAttribute("class","govuk-accordion--icon"),a.innerHTML=' <path class="govuk-accordion--icon-open" d="M13.3721 -7.11581e-08L7.48837 5.84655L1.5814 -5.86546e-07L-6.9424e-08 1.58823L7.51163 9L15 1.61125L13.3721 -7.11581e-08Z"/><rect class="govuk-accordion--icon-close" x="1.58691" y="0.0893555" width="16.0371" height="2.16583" transform="rotate(45 1.58691 0.0893555)"/><rect class="govuk-accordion--icon-close" x="0.0966797" y="11.34" width="16.0371" height="2.16583" transform="rotate(-45 0.0966797 11.34)"/>',e.appendChild(a)},t.prototype.setOpenAllButtonAttributes=function(e){e.textContent="Open all",e.setAttribute("class","govuk-accordion__expand-all"),e.setAttribute("aria-expanded","false"),e.setAttribute("type","button")},t.prototype.openOrCloseAllSections=function(){var e=this,t=this.$sections,i=!("true"===e.$openAllButton.getAttribute("aria-expanded"));o(t,function(t){e.setExpanded(i,t)}),e.updateOpenAllButton(i)},t.prototype.updateOpenAllButton=function(e){var t=e?"Close all":"Open all";this.$openAllButton.setAttribute("aria-expanded",e),this.$openAllButton.textContent=t},t.prototype.checkIfAllSectionsOpen=function(){var e=this,t=this.$sections,i=this.$sections.length,n=0;return o(t,function(t){e.isExpanded(t)&&n++}),i===n};var i=function(){var e,t="this is the test string";try{return window.sessionStorage.setItem(t,t),e=window.sessionStorage.getItem(t)===t.toString(),window.sessionStorage.removeItem(t),e}catch(e){}};function n(e){this.$module=e,this.$navToggle=e.querySelector(".navigation__toggle"),this.$navItems=e.querySelectorAll(".navigation__list-item")}function s(e){this.$dropCookie=!0,this.$cookieDuration=365,this.$cookieName="CookieConsent",this.$cookieValue="true",this.$cookieBanner=e,this.$cookieBannerParent=this.$cookieBanner.parentNode,this.$cookieBannerContinue=document.querySelector(".cookiebanner__button--continue"),this.$cookieBannerClose=document.querySelector(".cookiebanner--close"),this.$cookieModal=document.getElementById("modal-cookiesettings"),this.$MarketingcookieName="MarketingConsent",this.$MarketingcookieValue="false",this.$Marketingcheckbox=document.getElementById("cbxMarketingConsent"),this.$AnalyticscookieName="AnalyticsConsent",this.$AnalyticscookieValue="true",this.$AnalyticsCheckbox=document.getElementById("cbxAnalyticsConsent")}function a(e){this.$trackingEnabled=null!=e,this.$DataLayer=e}function r(e,t){this.$module=e,this.$videoPlayerId=this.$module.dataset.videoplayerid,this.$videoUrl=this.$module.dataset.videourl,this.$player=null,this.$playerElement=null,this.$playerClass=this.$module.dataset.playerclass,this.$videoPlayerTemplate='<div class="video-player plyr__video-embed js-player visually-hidden" id="{videoPlayerId}"><div class="video-player--inner-wrap"><a class="video-player__close" href="#"><span class="video-player__close-icon"></span> Close</a><iframe src="{videoUrl}" allowfullscreen allowtransparency allow="autoplay"></iframe></div></div>',this.$trackingEnabled=null!=t,this.$gtmDataLayer=t,this.$gtm=null,this.$playingTimer=null,this.$playingTimerTimespan=5e3}function l(e,t){var o=Math.pow(10,t||0);return Math.round(e*o)/o}function c(e){this.$module=e,this.$anchorLinks=e.querySelectorAll('a[href^="#"]')}function d(e,t){if(window.NodeList.prototype.forEach)return e.forEach(t);for(var o=0;o<e.length;o++)t.call(window,e[o],o,e)}t.prototype.storeState=function(){i()&&o(this.$sections,function(e){var t=!!e.querySelector("h2 [aria-controls]")&&e.querySelector("h2 [aria-controls]").getAttribute("aria-controls"),o=!!e.querySelector("h2 [aria-expanded]")&&e.querySelector("h2 [aria-expanded]").getAttribute("aria-expanded");!1===t&&console&&console.error(new Error("No aria controls present in accordion heading.")),!1===o&&console&&console.error(new Error("No aria expanded present in accordion heading.")),t&&o&&window.sessionStorage.setItem(t,o)})},t.prototype.readState=function(){i()&&o(this.$sections,function(e){var t,o=!!e.querySelector("h2 [aria-controls]")&&e.querySelector("h2 [aria-controls]").getAttribute("aria-controls");if(o&&(t=window.sessionStorage.getItem(o)),null!==t){var i="true"===t;this.setExpanded(i,e)}}.bind(this))},n.prototype.init=function(){this.$module&&(null!=this.$navToggle&&this.$navToggle.addEventListener("click",this.onToggleNav.bind(this,this.$navToggle)),function(e,t){if(window.NodeList.prototype.forEach)return e.forEach(t);for(var o=0;o<e.length;o++)t.call(window,e[o],o,e)}(this.$navItems,function(e,t){this.$subnavToggle=e.querySelector(".navigation__sub-menu-toggle"),null!=this.$subnavToggle&&this.$subnavToggle.addEventListener("click",this.onToggleSubNav.bind(this,e))}.bind(this)))},n.prototype.onToggleNav=function(){document.querySelector("body").classList.toggle("js-menu-open")},n.prototype.onToggleSubNav=function(e,t){t.preventDefault(),e.querySelector(".navigation__link--top-level").classList.toggle("sub-menu-open"),e.querySelector(".navigation__sub-menu").classList.toggle("js-show")},s.prototype.init=function(){null==this.checkCookie(this.$MarketingcookieName)&&this.createCookie(this.$MarketingcookieName,this.$MarketingcookieValue,this.$cookieDuration),null==this.checkCookie(this.$AnalyticscookieName)&&this.createCookie(this.$AnalyticscookieName,this.$AnalyticscookieValue,this.$cookieDuration),this.checkCookie(this.$cookieName)==this.$cookieValue?(this.removeBanner(),this.removeModal()):(this.showBanner(),this.$cookieBannerContinue.addEventListener("click",this.removeBannerEvent.bind(this,!0)),this.$cookieBannerClose.addEventListener("click",this.removeBannerEvent.bind(this,!1))),null!=this.$Marketingcheckbox&&null!=this.$AnalyticsCheckbox&&(this.$Marketingcheckbox.checked="true"===this.checkCookie(this.$MarketingcookieName),this.$AnalyticsCheckbox.checked="true"===this.checkCookie(this.$AnalyticscookieName))},s.prototype.removeBannerEvent=function(e,t){this.createCookie(this.$cookieName,this.$cookieValue,this.$cookieDuration),e&&(this.createCookie(this.$MarketingcookieName,"true",this.$cookieDuration),this.createCookie(this.$AnalyticscookieName,"true",this.$cookieDuration),this.removeModal()),this.removeBanner()},s.prototype.showBanner=function(){if(null!==this.$cookieBanner){var e=this.$cookieBanner.getAttribute("class").replace(" visually-hidden","");this.$cookieBanner.setAttribute("class",e)}},s.prototype.setChecked=function(e,t){var o=e.checked?"true":"false";this.createCookie(t,o,this.$cookieDuration)},s.prototype.createCookie=function(e,t,o){if(o){var i=new Date;i.setTime(i.getTime()+24*o*60*60*1e3);var n="; expires="+i.toGMTString()}else n="";this.$dropCookie&&(document.cookie=e+"="+t+n+"; path=/")},s.prototype.checkCookie=function(e){for(var t=e+"=",o=document.cookie.split(";"),i=0;i<o.length;i++){for(var n=o[i];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return null},s.prototype.eraseCookie=function(e){this.createCookie(e,"",-1)},s.prototype.removeBanner=function(){null!==this.$cookieBanner&&this.$cookieBannerParent.removeChild(this.$cookieBanner),null!=this.$Marketingcheckbox&&this.$Marketingcheckbox.addEventListener("click",this.setChecked.bind(this,this.$Marketingcheckbox,this.$MarketingcookieName)),this.$AnalyticsCheckbox&&this.$AnalyticsCheckbox.addEventListener("click",this.setChecked.bind(this,this.$AnalyticsCheckbox,this.$AnalyticscookieName))},s.prototype.removeModal=function(){null!==this.$cookieModal&&this.$cookieBannerParent.removeChild(this.$cookieModal)},a.prototype.sendEvent=function(e,t){t.event=e;JSON.stringify(t);this.$DataLayer.push(t)},r.prototype.init=function(){if(this.$module){this.appendPlayer(),this.$playerElement=document.getElementById(this.$videoPlayerId),null!=this.$playerClass&&this.$playerElement.classList.add(this.$playerClass),this.$player=new Plyr(this.$playerElement);var e="click";1==this.$player.touch&&(e="touchstart"),this.$module.addEventListener(e,this.play.bind(this)),this.$closeButton=this.$playerElement.querySelector(".video-player__close"),this.$closeButton.addEventListener(e,this.close.bind(this)),this.$module.classList.remove("visually-hidden"),this.$trackingEnabled&&(this.$gtm=new a(this.$gtmDataLayer),this.enableEvents())}},r.prototype.appendPlayer=function(){var e=this.$videoPlayerTemplate.replace("{videoPlayerId}",this.$videoPlayerId).replace("{videoUrl}",this.$videoUrl);window.document.body.insertAdjacentHTML("beforeend",e)},r.prototype.close=function(e){this.$player.stop(),e.preventDefault()},r.prototype.play=function(e){this.$player.play(),e.preventDefault()},r.prototype.isSmallScreen=function(){return window.innerWidth<900},r.prototype.enableEvents=function(){this.$player.on("play",e=>{0==this.$player.currentTime?this.sendEvent("video_started"):this.sendEvent("video_play"),this.$playingTimer=setInterval(this.sendPlayingEvent.bind(this,this),this.$playingTimerTimespan)}),this.$player.on("ended",e=>{this.sendEvent("video_ended"),clearInterval(this.$playingTimer)}),this.$player.on("pause",e=>{this.sendEvent("video_paused"),clearInterval(this.$playingTimer)})},r.prototype.sendEvent=function(e){var t={currentTimestamp:l(this.$player.currentTime,1),totalVideoPlayed:l(this.$player.currentTime/this.$player.duration,2),totalVideoDuration:this.$player.duration,videoId:this.$player.embed.getVideoData().video_id};this.$gtm.sendEvent(e,t)},r.prototype.sendPlayingEvent=function(e){e.sendEvent("video_playing")},c.prototype.init=function(e,t){this.$anchorLinks.forEach(e=>{var t=document.querySelector(e.hash);null!=t&&e.addEventListener("click",this.smoothScroll.bind(this,t,500,"easeInOutQuart",null))})},c.prototype.smoothScroll=function(e,t=500,o="easeInOutQuart",i){const n={easeInOutQuart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e},s=window.pageYOffset,a="now"in window.performance?performance.now():(new Date).getTime(),r=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),l=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight,c=("number"==typeof e?e:e.offsetTop)-150,d=Math.round(r-c<l?r-l:c);if("requestAnimationFrame"in window==!1)return window.scroll(0,d),void(i&&i());!function e(){const r="now"in window.performance?performance.now():(new Date).getTime(),l=Math.min(1,(r-a)/t),c=n[o](l);window.scroll(0,Math.ceil(c*(d-s)+s)),window.pageYOffset!==d?requestAnimationFrame(e):i&&i()}()},e.initAll=function(){d(document.querySelectorAll('[data-module="accordion"]'),function(e){new t(e).init()}),d(document.querySelectorAll('[data-module="navigation"]'),function(e){new n(e).init()});var e=document.querySelector('[data-module="cookieBanner"]');null!=e&&new s(e).init();var o=window.dataLayer;document.querySelectorAll('[data-module="videoPlayer"]').forEach(function(e){new r(e,o).init()}),document.querySelectorAll('[data-module="smoothScroll"]').forEach(function(e){new c(e).init()}),"undefined"!=typeof aspnetValidation&&(new aspnetValidation.ValidationService).bootstrap()},e.Accordion=t,e.Navigation=n,e.CookieBanner=s,e.VideoPlayer=r},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("DASFrontend",["exports"],t):t(e.DASFrontend={});
